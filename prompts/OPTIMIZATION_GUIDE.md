# AI 交易提示词优化说明

## 🎯 优化目标

解决 AI 交易系统总是偏好做空的问题，建立更平衡、更符合市场实际的交易策略。

## 📊 问题分析

### 原始问题
1. **AI 总是倾向于做空**，即使在牛市环境中
2. **缺乏市场大环境判断**，没有考虑整体趋势
3. **多空决策标准一致**，没有区分顺势和逆势交易
4. **忽视 BTC 领先作用**，没有充分利用 BTC 作为市场领导者的指示作用

### 根本原因
- 提示词中有专门的"做空策略指导"章节，可能被 AI 过度重视
- 缺乏"市场环境优先"的决策框架
- 没有明确"顺势交易为主，逆势交易需极高标准"的原则
- 多空决策使用相同的信心度阈值（75），没有根据市场环境动态调整

---

## ✨ 优化方案

### 1. 新增市场环境识别机制（核心改进）

在所有交易决策之前，首先判断市场大环境：

#### **牛市环境识别**
- BTC 多周期（15m/1h/4h）MACD 持续 >0
- BTC 近 7 日涨幅显著
- 资金费率持续为正（多头支付空头）
- 山寨币普遍上涨

**策略倾向**：
- ✅ 优先做多（信心度 ≥75）
- ⚠️ 做空需极高标准（信心度 ≥90）

#### **熊市环境识别**
- BTC 多周期（15m/1h/4h）MACD 持续 <0
- BTC 近 7 日跌幅显著
- 资金费率持续为负（空头支付多头）
- 山寨币普遍下跌

**策略倾向**：
- ✅ 优先做空（信心度 ≥75）
- ⚠️ 做多需极高标准（信心度 ≥90）

#### **震荡环境识别**
- BTC 多周期 MACD 方向不一致
- BTC 横盘整理，无明确趋势
- 资金费率在零值附近波动
- 山寨币涨跌参半

**策略倾向**：
- ⚖️ 多空平衡，两个方向都要信心度 ≥85
- 📌 区间交易，高标准开仓

---

### 2. 差异化的开仓标准

#### **顺势交易**（符合市场大环境）
- 信心度阈值：≥75
- 时间框架确认：至少 2 个（15m + 1h 或 1h + 4h）
- 技术指标：常规标准
- 成交量：配合即可

#### **逆势交易**（对抗市场大环境）
- 信心度阈值：≥90（必须极高）
- 时间框架确认：至少 3 个（15m + 1h + 4h）
- 技术指标：多重共振
- 成交量：必须大量放量
- 反转形态：明确的顶部/底部形态

---

### 3. 强化 BTC 领先指标作用

**交易任何山寨币前，必须先确认 BTC 状态**：

- **BTC 强势上涨** → 山寨币优先做多
- **BTC 强势下跌** → 山寨币优先做空
- **BTC 震荡不明** → 提高开仓标准，观望为主

---

### 4. 优化决策流程

新的决策流程（严格按顺序）：

```
1. 判断市场大环境
   ↓
   输出：牛市/熊市/震荡
   确定：策略倾向（优先做多/做空/平衡）

2. 评估现有持仓
   ↓
   检查：持仓方向是否符合大趋势
   决策：hold / close / 调整止损止盈

3. 寻找新机会
   ↓
   重点方向：根据策略倾向寻找机会
   - 牛市 → 重点寻找做多机会
   - 熊市 → 重点寻找做空机会
   - 震荡 → 多空平衡，高标准

4. 多维度验证
   ↓
   顺势交易：5/8 指标一致（信心度 ≥75）
   逆势交易：7/8 指标一致（信心度 ≥90）

5. 输出决策
   ↓
   先说明市场环境判断
   再进行思维链分析
   最后输出 JSON 决策
```

---

## 📁 文件修改清单

### 1. 新增文件

#### `prompts/balanced_trading.txt` ⭐（推荐使用）
完全重写的平衡交易提示词，核心特点：
- ✅ 完整的市场环境识别框架
- ✅ 差异化的多空开仓标准
- ✅ 强调顺势交易，逆势谨慎
- ✅ 详细的决策流程指引
- ✅ 自我检查清单

**推荐场景**：所有交易场景，特别是当前出现做空偏好问题时

### 2. 修改文件

#### `prompts/default.txt` ✏️
在原有基础上添加：
- ✅ 市场环境识别章节
- ✅ 根据环境调整开仓标准
- ✅ 优化决策流程（环境判断优先）

**适用场景**：保留原有逻辑，增加环境判断

#### `prompts/adaptive.txt` ✏️
在高级版本基础上添加：
- ✅ 第 6 步：市场环境判断（最优先）
- ✅ 第 7 步：差异化的多空确认清单
- ✅ 顺势 vs 逆势的不同标准

**适用场景**：需要更复杂决策逻辑的高级场景

---

## 🚀 使用建议

### 方式一：直接切换到新提示词（推荐）

在 Web 界面中配置 AI 模型时，选择使用新的提示词模板：
- 选择模板：`balanced_trading`

这会使用完全优化后的新提示词，解决做空偏好问题。

### 方式二：使用优化后的默认提示词

如果你习惯使用 `default.txt`，我已经对它进行了优化，它现在包含：
- 市场环境识别
- 顺势交易优先
- 差异化开仓标准

继续使用 `default` 模板即可。

### 方式三：使用高级自适应提示词

如果需要更复杂的决策逻辑，使用 `adaptive` 模板：
- 包含更严格的防假突破机制
- 多周期确认
- 信号优先级排序

---

## 🎯 预期效果

优化后，AI 应该会：

1. **✅ 在牛市中主要做多**
   - 回调时寻找做多机会
   - 只在极强反转信号时才做空
   - 信心度 ≥90 才会逆势做空

2. **✅ 在熊市中主要做空**
   - 反弹时寻找做空机会
   - 只在极强反转信号时才做多
   - 信心度 ≥90 才会逆势做多

3. **✅ 在震荡市中谨慎操作**
   - 多空都保持高标准（≥85）
   - 区间交易，快进快出
   - 减少交易频率

4. **✅ 考虑 BTC 影响**
   - 交易山寨币前先看 BTC
   - BTC 上涨时倾向做多山寨
   - BTC 下跌时倾向做空山寨

---

## 📝 自我检查清单

AI 在输出决策前会检查：

1. ✅ 我明确了当前市场大环境吗？（牛市/熊市/震荡）
2. ✅ 我的交易方向符合大趋势吗？（顺势还是逆势）
3. ✅ 如果是逆势交易，我的信心度够高吗？（≥90）
4. ✅ BTC 状态是否支持我的方向？
5. ✅ 我有至少 3 个开仓理由吗？
6. ✅ 风险收益比是否合理？（≥1:2）
7. ✅ 如果用自己的钱，我会开这单吗？

任一问题回答"否" → 选择 wait

---

## ⚠️ 重要提醒

1. **市场环境第一**：永远先判断大环境再决策
2. **顺势为王**：牛市做多、熊市做空、震荡高标准
3. **BTC 领先**：山寨币看 BTC 脸色
4. **逆势谨慎**：逆市操作需要 90+ 信心度
5. **质量优于数量**：宁可错过，不做错

### 核心理念

> **牛市不言顶，熊市不言底**
> **趋势的力量超出想象**
> **与趋势为友，不要做趋势的敌人**

---

## 🧪 测试建议

优化后建议进行以下测试：

1. **牛市环境测试**
   - 观察 AI 是否主要寻找做多机会
   - 检查做空决策的信心度是否 ≥90
   - 确认是否充分利用回调做多

2. **熊市环境测试**
   - 观察 AI 是否主要寻找做空机会
   - 检查做多决策的信心度是否 ≥90
   - 确认是否充分利用反弹做空

3. **震荡环境测试**
   - 观察 AI 是否多空平衡
   - 检查开仓频率是否降低
   - 确认信心度是否都 ≥85

---

## 📞 反馈与调整

如果优化后仍然出现问题，可以考虑：

1. **进一步提高逆势交易标准**
   - 将逆势信心度从 90 提高到 95
   - 要求更多时间框架确认（4 个以上）

2. **添加市场情绪权重**
   - 加入更多市场情绪指标（如恐惧贪婪指数）
   - 根据情绪极端程度调整策略

3. **细化不同币种策略**
   - BTC/ETH 使用更保守策略
   - 山寨币策略根据市值分级

4. **回测与数据分析**
   - 记录每笔交易的市场环境
   - 分析不同环境下的胜率和盈亏比
   - 根据数据调整参数

---

## 📚 相关文档

- [原始提示词](default.txt)
- [优化提示词](balanced_trading.txt)
- [高级自适应提示词](adaptive.txt)
- [决策引擎代码](../decision/engine.go)
- [提示词管理器](../decision/prompt_manager.go)

---

**更新日期**: 2025-11-06
**版本**: V6.0 - 市场环境感知版
